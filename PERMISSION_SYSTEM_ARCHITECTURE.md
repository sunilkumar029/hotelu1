# ğŸ“Š Permission System - Visual Architecture

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND (React)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  App.jsx                    Sidebar.jsx                          â”‚
â”‚  â”œâ”€ Routes                  â”œâ”€ Menu Items                        â”‚
â”‚  â””â”€ Auth State              â””â”€ Permission Checks                 â”‚
â”‚                                                                   â”‚
â”‚  UserManagement.jsx         PermissionManagement.jsx             â”‚
â”‚  â”œâ”€ Create User             â”œâ”€ Create Role                       â”‚
â”‚  â”œâ”€ Edit User               â”œâ”€ Assign Permissions                â”‚
â”‚  â”œâ”€ Delete User             â””â”€ View Permissions                  â”‚
â”‚  â””â”€ List Users                                                   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                        JWT Token
                        (Authorization Header)
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     BACKEND (Node + Express)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  API Routes                                                       â”‚
â”‚  â”œâ”€ POST   /api/users           â”€â”€â”                             â”‚
â”‚  â”œâ”€ GET    /api/users           â”€â”€â”¤ User CRUD                   â”‚
â”‚  â”œâ”€ PUT    /api/users/:id       â”€â”€â”¤                             â”‚
â”‚  â”œâ”€ DELETE /api/users/:id       â”€â”€â”˜                             â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€ GET    /api/permissions     â”€â”€â”                             â”‚
â”‚  â”œâ”€ GET    /api/roles           â”€â”€â”¤ Permission                  â”‚
â”‚  â”œâ”€ POST   /api/roles           â”€â”€â”¤ Management                  â”‚
â”‚  â”œâ”€ PUT    /api/roles/:id/permissions                           â”‚
â”‚  â””â”€ GET    /api/my-permissions  â”€â”€â”˜                             â”‚
â”‚                                                                   â”‚
â”‚  Middleware                                                       â”‚
â”‚  â”œâ”€ verifyToken (âœ“ JWT validation)                              â”‚
â”‚  â”œâ”€ verifyAdmin (âœ“ Admin check)                                 â”‚
â”‚  â””â”€ checkPermission (âœ“ Permission validation)                   â”‚
â”‚                                                                   â”‚
â”‚  Models                                                           â”‚
â”‚  â”œâ”€ User (username, password, role)                             â”‚
â”‚  â”œâ”€ Role (name, description)                                    â”‚
â”‚  â”œâ”€ Permission (name, category)                                 â”‚
â”‚  â””â”€ RolePermission (roleId, permissionId)                       â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                        Database Queries
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DATABASE (MySQL)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  users table                                                      â”‚
â”‚  â”œâ”€ id (PK)                                                      â”‚
â”‚  â”œâ”€ username                                                     â”‚
â”‚  â”œâ”€ password (hashed)                                           â”‚
â”‚  â”œâ”€ role                                                         â”‚
â”‚  â””â”€ name                                                         â”‚
â”‚                                                                   â”‚
â”‚  roles table                                                      â”‚
â”‚  â”œâ”€ id (PK)                                                      â”‚
â”‚  â”œâ”€ name                                                         â”‚
â”‚  â”œâ”€ description                                                  â”‚
â”‚  â””â”€ isDefault                                                    â”‚
â”‚                                                                   â”‚
â”‚  permissions table                                                â”‚
â”‚  â”œâ”€ id (PK)                                                      â”‚
â”‚  â”œâ”€ name                                                         â”‚
â”‚  â”œâ”€ description                                                  â”‚
â”‚  â””â”€ category                                                     â”‚
â”‚                                                                   â”‚
â”‚  role_permissions table                                           â”‚
â”‚  â”œâ”€ id (PK)                                                      â”‚
â”‚  â”œâ”€ roleId (FK)                                                  â”‚
â”‚  â””â”€ permissionId (FK)                                            â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Login Page   â”‚
â”‚  (credentials) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ POST /login {username, password}
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend      â”‚
â”‚  Validates    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Generates JWT Token
        â”‚ Token includes: {username, role, name}
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Return Token + User Data              â”‚
â”‚  {                                     â”‚
â”‚    token: "eyJhbGc...",               â”‚
â”‚    user: {username, role, name}       â”‚
â”‚  }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Frontend stores in localStorage
        â”‚ authToken + currentUser
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  All Future Requests                   â”‚
â”‚  Authorization: Bearer {token}         â”‚
â”‚  (Sent automatically by api.js)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Backend verifies token
        â”‚ Backend checks permissions
        â”‚ Allow or Deny
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  200 OK - Permission Granted           â”‚
â”‚  403 Forbidden - Permission Denied     â”‚
â”‚  401 Unauthorized - Token Invalid      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Permission Checking Flow

```
User clicks "Create User" button
        â”‚
        â–¼
Is user logged in?
        â”‚
        â”œâ”€ No â†’ Show Login
        â””â”€ Yes â†’ Continue
                 â”‚
                 â–¼
         Frontend checks localStorage
         for currentUser.role
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚          â”‚         â”‚
       Yes               No       Skip if      ...
        â”‚                 â”‚      not admin     â”‚
        â”œâ”€ Show form      â””â”€ Hide button     â”‚
        â”‚                                    â”‚
        â–¼                                    â–¼
   User fills form              (User doesn't see)
        â”‚
        â–¼
   POST /api/users
   + Authorization: Bearer {token}
   + {username, password, name, role}
        â”‚
        â–¼
   Backend:
   1. Verify token âœ“
   2. Extract user
   3. Check role === 'admin' âœ“
   4. Validate input âœ“
   5. Create user in DB âœ“
        â”‚
        â”œâ”€ Success (200)
        â”‚   â”‚
        â”‚   â–¼
        â”‚   Frontend shows:
        â”‚   âœ… "User created successfully"
        â”‚
        â””â”€ Error (403, 400, 409)
            â”‚
            â–¼
            Frontend shows:
            âŒ Error message
```

---

## ğŸ‘¥ Role & Permission Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ROLES                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Admin              Manager           Chef                  â”‚
â”‚  â”œâ”€ All 23 perms    â”œâ”€ 15 perms      â”œâ”€ 3 perms           â”‚
â”‚  â”‚                  â”‚                â”‚                     â”‚
â”‚  â””â”€â†’ User can       â””â”€â†’ Can manage   â””â”€â†’ View orders      â”‚
â”‚      do anything        orders            Kitchen          â”‚
â”‚                         menus             Display          â”‚
â”‚                         inventory                          â”‚
â”‚                                                              â”‚
â”‚  Waiter             Franchise         Sub-Franchise        â”‚
â”‚  â”œâ”€ 5 perms         â”œâ”€ 11 perms      â”œâ”€ 16 perms          â”‚
â”‚  â”‚                  â”‚                â”‚                     â”‚
â”‚  â””â”€â†’ Create orders  â””â”€â†’ Multi-store  â””â”€â†’ Single store     â”‚
â”‚      View bills         management        management      â”‚
â”‚      Payments                                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                   â”‚                   â”‚
           â”‚                   â”‚                   â”‚
           â–¼                   â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             PERMISSIONS (23 total)                    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                       â”‚
    â”‚ User Mgmt      Menu Mgmt      Order Mgmt            â”‚
    â”‚ â”œâ”€ view        â”œâ”€ view        â”œâ”€ view              â”‚
    â”‚ â”œâ”€ create      â”œâ”€ create      â”œâ”€ create            â”‚
    â”‚ â”œâ”€ edit        â”œâ”€ edit        â”œâ”€ edit              â”‚
    â”‚ â”œâ”€ delete      â”œâ”€ delete      â”œâ”€ delete            â”‚
    â”‚ â””â”€ manage      â”‚              â””â”€ qr_codes          â”‚
    â”‚                â”‚                                    â”‚
    â”‚ Inventory     Billing        Reporting             â”‚
    â”‚ â”œâ”€ view        â”œâ”€ view        â”œâ”€ dashboard         â”‚
    â”‚ â””â”€ edit        â”œâ”€ process     â”œâ”€ reports           â”‚
    â”‚                â””â”€ bills       â””â”€ kitchen_display   â”‚
    â”‚                                                     â”‚
    â”‚ Settings                                           â”‚
    â”‚ â””â”€ manage                                          â”‚
    â”‚                                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Model Relationships

```
                 User
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ id (PK)â”‚
            â”‚usernameâ”‚
            â”‚passwordâ”‚ (hashed)
            â”‚ role   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ name   â”‚          â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                                â”‚
                         (string reference)
                                â”‚
                                â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   Role     â”‚
                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                         â”‚ id (PK)    â”‚
                         â”‚ name       â”‚
                         â”‚ descriptionâ”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    (many-to-many junction)
                                â”‚
                                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  RolePermission      â”‚
                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                     â”‚ id (PK)              â”‚
                     â”‚ roleId (FK)          â”‚
                     â”‚ permissionId (FK)    â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ Permission     â”‚
                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                         â”‚ id (PK)        â”‚
                         â”‚ name           â”‚
                         â”‚ category       â”‚
                         â”‚ description    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Flow:
User has one role (e.g., "admin")
    â†“
Role has many permissions (e.g., 23 permissions)
    â†“
Each permission is unique (e.g., "create_user")
    â†“
User inherits all role's permissions
```

---

## ğŸ” Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Layer 1: Frontend Authentication            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ“ Login form validation                            â”‚
â”‚  âœ“ Token stored securely (localStorage)            â”‚
â”‚  âœ“ Token sent on all requests                      â”‚
â”‚  âœ“ UI hides features based on role                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Layer 2: API Authentication                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ“ JWT token verified                              â”‚
â”‚  âœ“ Token signature checked                         â”‚
â”‚  âœ“ Token expiration checked                        â”‚
â”‚  âœ“ Invalid tokens rejected (401)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Layer 3: Permission Authorization              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ“ User role verified                              â”‚
â”‚  âœ“ Role permissions looked up                      â”‚
â”‚  âœ“ Specific permission checked                     â”‚
â”‚  âœ“ Insufficient permissions rejected (403)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Layer 4: Database Security                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ“ Passwords hashed (bcrypt)                       â”‚
â”‚  âœ“ Foreign key constraints                         â”‚
â”‚  âœ“ Unique constraints (no duplicate usernames)     â”‚
â”‚  âœ“ Query validation                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ User Creation Flow

```
Admin clicks "+ Add New User"
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UserManagement Component           â”‚
â”‚   â”œâ”€ Form Fields:                    â”‚
â”‚   â”‚  â”œâ”€ username (text)              â”‚
â”‚   â”‚  â”œâ”€ password (password)          â”‚
â”‚   â”‚  â”œâ”€ name (text)                  â”‚
â”‚   â”‚  â””â”€ role (dropdown)              â”‚
â”‚   â””â”€ Validation:                     â”‚
â”‚      â”œâ”€ username required âœ“          â”‚
â”‚      â”œâ”€ password min 4 chars âœ“       â”‚
â”‚      â”œâ”€ name required âœ“              â”‚
â”‚      â””â”€ role valid âœ“                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ POST /api/users
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Backend Server                     â”‚
â”‚   1. Verify JWT token âœ“              â”‚
â”‚   2. Extract username from token     â”‚
â”‚   3. Check: role === 'admin' âœ“       â”‚
â”‚   4. Check: username unique âœ“        â”‚
â”‚   5. Hash password (bcrypt)          â”‚
â”‚   6. Create user record in DB        â”‚
â”‚   7. Associate role                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€ Success (201)
        â”‚   â”‚
        â”‚   â–¼
        â”‚   Frontend:
        â”‚   â”œâ”€ Show notification âœ…
        â”‚   â”œâ”€ Clear form
        â”‚   â””â”€ Refresh user list
        â”‚       (user now appears)
        â”‚
        â””â”€ Error (403, 400, 409)
            â”‚
            â–¼
            Frontend:
            â””â”€ Show error notification âŒ

Database Result:
users table:
â”‚ id â”‚ username   â”‚ password_hash          â”‚ role   â”‚ name       â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚ admin      â”‚ $2b$10$...hashed...   â”‚ admin  â”‚ Admin User â”‚
â”‚ 2  â”‚ newuser    â”‚ $2b$10$...hashed...   â”‚ waiter â”‚ New User   â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

waiter role gets these permissions:
- create_order
- view_orders
- edit_order
- view_menu
- view_billing
- process_payments
- view_bills
- manage_qr_codes
```

---

## ğŸ“ˆ Permission Assignment

```
Admin goes to Permission Management
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  View Existing Roles    â”‚
â”‚  â”œâ”€ admin               â”‚
â”‚  â”œâ”€ manager             â”‚
â”‚  â”œâ”€ chef                â”‚
â”‚  â”œâ”€ waiter              â”‚
â”‚  â”œâ”€ franchise           â”‚
â”‚  â””â”€ subfranchise        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Click "Edit Permissions" on waiter
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Edit waiter Role Permissions        â”‚
â”‚  â˜‘ create_order                      â”‚
â”‚  â˜‘ view_orders                       â”‚
â”‚  â˜‘ edit_order                        â”‚
â”‚  â˜ delete_order (not checked)        â”‚
â”‚  â˜‘ view_menu                         â”‚
â”‚  â˜‘ view_billing                      â”‚
â”‚  â˜‘ process_payments                  â”‚
â”‚  â˜‘ view_bills                        â”‚
â”‚  â˜‘ manage_qr_codes                   â”‚
â”‚  â˜ view_dashboard (not checked)      â”‚
â”‚  ...                                 â”‚
â”‚                                      â”‚
â”‚  [Save] [Cancel]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Click Save
        â”‚
        â–¼
Backend:
1. Verify admin user
2. Delete all old waiter permissions
3. Insert new permissions checked
4. Return success (200)
        â”‚
        â–¼
Frontend:
1. Show âœ… "Permissions updated"
2. User list refreshes
3. Any logged-in waiters get new permissions
   on their next API call
```

---

## ğŸ¯ Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Role-Based Permission System Summary           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Frontend (React)                                   â”‚
â”‚  â””â”€ User Management                                 â”‚
â”‚     Permission Management                          â”‚
â”‚                          â”‚                          â”‚
â”‚  API Layer (Express)     â”‚                          â”‚
â”‚  â””â”€ 8 Endpoints          â”‚                          â”‚
â”‚                          â”‚                          â”‚
â”‚  Auth Middleware         â”‚                          â”‚
â”‚  â””â”€ JWT Verification     â”‚                          â”‚
â”‚     Permission Checking  â”‚                          â”‚
â”‚                          â”‚                          â”‚
â”‚  Database (MySQL)        â”‚                          â”‚
â”‚  â””â”€ 4 Tables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚     Users, Roles,                                   â”‚
â”‚     Permissions,                                    â”‚
â”‚     RolePermissions                                 â”‚
â”‚                                                      â”‚
â”‚  Result:                                            â”‚
â”‚  âœ… Secure authentication                          â”‚
â”‚  âœ… Granular permissions                           â”‚
â”‚  âœ… Easy role management                           â”‚
â”‚  âœ… Scalable user system                           â”‚
â”‚  âœ… Production ready                               â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Visual Overview Complete!**

All diagrams show how the permission system is architected and how data flows through the system.
